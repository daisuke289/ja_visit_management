<%= form_with model: [@customer, @diagnosis], class: 'space-y-6' do |f| %>
  <% if @diagnosis.errors.any? %>
    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
      <h4 class="text-red-800 font-medium">エラーが発生しました</h4>
      <ul class="mt-2 text-sm text-red-600 list-disc list-inside">
        <% @diagnosis.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="bg-white rounded-lg shadow">
    <div class="px-6 py-4 border-b border-gray-200">
      <h3 class="text-lg font-semibold text-gray-800">診断情報</h3>
    </div>
    <div class="p-6 space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <%= f.label :title, 'タイトル', class: 'block text-sm font-medium text-gray-700 mb-1' %>
          <%= f.text_field :title, placeholder: '例: 2024年度財産診断', class: 'w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500' %>
        </div>
        <div>
          <%= f.label :diagnosed_on, '診断実施日', class: 'block text-sm font-medium text-gray-700 mb-1' %>
          <%= f.date_field :diagnosed_on, class: 'w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500' %>
        </div>
      </div>

      <div>
        <%= f.label :notes, '備考', class: 'block text-sm font-medium text-gray-700 mb-1' %>
        <%= f.text_area :notes, rows: 3, class: 'w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500' %>
      </div>
    </div>
  </div>

  <div class="bg-white rounded-lg shadow">
    <div class="px-6 py-4 border-b border-gray-200">
      <h3 class="text-lg font-semibold text-gray-800">ファイルアップロード</h3>
    </div>
    <div class="p-6 space-y-4">
      <% if @diagnosis.document.attached? %>
        <div class="p-4 bg-gray-50 rounded-lg">
          <div class="flex items-center space-x-3">
            <span class="text-3xl"><%= @diagnosis.document_icon %></span>
            <div>
              <p class="font-medium">現在のファイル: <%= @diagnosis.document.filename %></p>
              <p class="text-sm text-gray-500"><%= number_to_human_size(@diagnosis.document.byte_size) %></p>
            </div>
          </div>
        </div>
      <% end %>

      <div>
        <%= f.label :document, '診断書ファイル（PDF/PowerPoint）', class: 'block text-sm font-medium text-gray-700 mb-1' %>
        <%= f.file_field :document,
            accept: '.pdf,.ppt,.pptx,application/pdf,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation',
            class: 'w-full border border-gray-300 rounded-lg p-2 focus:ring-blue-500 focus:border-blue-500' %>
        <p class="text-xs text-gray-500 mt-1">対応形式: PDF, PowerPoint (.ppt, .pptx) / 最大50MB</p>
      </div>
    </div>
  </div>

  <div class="flex justify-end space-x-4">
    <%= link_to 'キャンセル', customer_diagnoses_path(@customer), class: 'bg-gray-200 hover:bg-gray-300 text-gray-700 px-6 py-2 rounded-lg' %>
    <%= f.submit @diagnosis.new_record? ? '登録する' : '更新する', class: 'bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg cursor-pointer' %>
  </div>
<% end %>
